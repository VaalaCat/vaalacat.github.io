(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{7689:function(e,t,a){Promise.resolve().then(a.t.bind(a,7405,23)),Promise.resolve().then(a.t.bind(a,3362,23)),Promise.resolve().then(a.t.bind(a,1122,23)),Promise.resolve().then(a.t.bind(a,6383,23)),Promise.resolve().then(a.bind(a,9682))},125:function(e,t,a){"use strict";a.d(t,{H:function(){return d}});var n=a(488);a(636);var r=a(6707),s=a(8912),c=a(9329),o=a(2242),l=a(7875),i=a(9158);let d=e=>{let[t,a]=(0,s.useState)(""),{data:d}=(0,c.a)({queryKey:["waline-status"],queryFn:()=>fetch("".concat(o.s.comment.walineapi,"/api/comment")).then(e=>e.status)});return(0,s.useEffect)(()=>{i&&a(window.location.hostname)},[]),(0,n.jsxs)(n.Fragment,{children:[200!==d&&(0,n.jsx)("div",{className:"text-center mt-6 text-red-500 text-sm",children:"服务器不可用，评论处于只读状态，请联系 me@vaala.cat 修复该问题"}),(0,n.jsx)(r.WalineComponent,{path:e.path,locale:{placeholder:"说点什么吧"},imageUploader:!1,emoji:!1,search:!1,reaction:!1,serverURL:200===d||0===t.length?o.s.comment.walineapi:"https://".concat(t,"/comments/").concat(function(e){let t=e.endsWith(l.sep)?e.slice(0,-1):e;return l.basename(t)}(e.path))})]})}},2181:function(e,t,a){"use strict";a.d(t,{i:function(){return d}});var n=a(488),r=a(9614),s=a.n(r),c=a(7259),o=a.n(c),l=a(6845);let i={Image:s(),a:o()};function d(e){let{code:t}=e,a=(0,l.z)(t);return(0,n.jsx)(a,{className:"break-all",components:i})}},9682:function(e,t,a){"use strict";a.r(t),a.d(t,{PostContent:function(){return p}});var n=a(488);a(1633);var r=a(5513).Buffer;async function s(e,t,a){let n=new TextEncoder().encode(t),r=await e.digest("SHA-256",n);return await e.importKey("raw",r,a,!0,["encrypt","decrypt"])}async function c(e,t,a){let n=r.from(a,"base64"),c={name:"AES-CBC",iv:n},o=await s(crypto.subtle,t,c),l=r.from(e,"base64");try{let e=await crypto.subtle.decrypt(c,o,l);return new TextDecoder().decode(e)}catch(e){console.error(e);return}}var o=a(8912),l=a(2181),i=a(9004),d=a(4871),u=a(125);let m=e=>{let{decrypt:t}=e,[a,r]=(0,o.useState)(""),[s,c]=(0,o.useState)(!1),l=(0,o.useCallback)(async e=>{try{e.preventDefault(),console.log("decrypt,",await t(a))}catch(e){c(!0)}},[t,a]);return(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,n.jsx)("div",{children:"文章需要密码访问"}),(0,n.jsxs)("form",{className:"flex flex-col items-center gap-2",onSubmit:l,children:[(0,n.jsx)("input",{className:"border rounded",type:"password",autoComplete:"none",onChange:e=>r(e.target.value)}),s&&(0,n.jsx)("div",{children:"密码错误"}),(0,n.jsx)("button",{type:"submit",className:"border rounded px-2",children:"提交"})]})]})},p=e=>{let{post:t}=e,[a,r]=(0,o.useState)(t.body.code),s=(0,o.useCallback)(async e=>{let a=await c(t.body.code,e,t.iv);return console.log("decript post with iv",t.body.code,t.iv),a&&r(a),!!a},[t.body.code,t.iv]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:"mb-2",children:t.title}),t.description&&(0,n.jsx)("p",{className:"text-xl mt-0 text-slate-700 dark:text-slate-200",children:t.description}),(0,n.jsx)("hr",{className:"my-4"}),t.password&&a===t.body.code?(0,n.jsx)(m,{decrypt:s}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("time",{dateTime:t.date,className:"mb-2 block text-xs text-gray-600 dark:text-gray-300",children:(0,i.WU)((0,d.D)(t.date),"LLLL d, yyyy")}),(0,n.jsx)(l.i,{code:a}),(0,n.jsx)("div",{className:"text-sm w-full text-center text-slate-500 mt-6 mb-2",children:"- The End -"}),(0,n.jsx)("hr",{}),(void 0==t.comments||t.comments)&&(0,n.jsx)(u.H,{path:"/posts/".concat(encodeURIComponent(t.slugAsParams),"/")})]})]})}},6707:function(e,t,a){"use strict";a.r(t),a.d(t,{WalineCommentCount:function(){return d},WalineComponent:function(){return i},WalineVisitCount:function(){return u}});var n=a(488),r=a(8912),s=a(1349);a(2547);var c=a(4194),o=a(9329),l=a(2242);let i=e=>{let{theme:t,systemTheme:a}=(0,c.F)(),o=(0,r.useRef)(null),l=r.createRef();return(0,r.useEffect)(()=>(o.current=(0,s.S1)({...e,dark:void 0===t||"system"===t?"dark"===a:"dark"===t,el:l.current,pageview:!0}),()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.destroy()}),[l,t,a]),(0,r.useEffect)(()=>{var n;let r={...e,dark:void 0===t||"system"===t?"dark"===a:"dark"===t};null===(n=o.current)||void 0===n||n.update(r)},[e,t,a]),(0,n.jsx)("div",{ref:l})},d=e=>{let t=e.slugAsParams.split("/").pop(),a=encodeURIComponent("/posts/"+t+"/"),{data:r,isSuccess:s}=(0,o.a)({queryKey:["waline-comment-count",t],queryFn:()=>fetch("".concat(l.s.comment.walineapi,"/api/comment?type=count&url=").concat(a)).then(e=>{if(200!==e.status)throw Error(e.statusText);return e.json()})});return s&&r&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mx-1 block text-xs text-gray-600 dark:text-gray-300",children:"|"}),(0,n.jsxs)("div",{className:"block text-xs text-gray-600 dark:text-gray-300",children:["Comments: ",(null==r?void 0:r.data)&&(null==r?void 0:r.data[0])?null==r?void 0:r.data[0]:0]})]})},u=e=>{let t=e.slugAsParams.split("/").pop(),a=encodeURIComponent("/posts/"+t+"/"),{data:r}=(0,o.a)({queryKey:["waline-visit-count",t],queryFn:()=>fetch("".concat(l.s.comment.walineapi,"/api/article?path=").concat(a)).then(e=>e.json())});return(0,n.jsxs)("div",{className:"block text-xs text-gray-600 dark:text-gray-300",children:["Visitors: ",r&&(null==r?void 0:r.data)&&(null==r?void 0:r.data[0].time)?null==r?void 0:r.data[0].time:0]})}},2242:function(e,t,a){"use strict";a.d(t,{s:function(){return n}});let n={title:"Vaala Cat",description:"Vaala Cat | 鲸喵",url:"https://vaala.cat",rss:{url:"https://vaala.cat/atom.xml",image_url:"https://vaala.cat/images/blog/avatar.png"},author:"Vaala Cat",comment:{walineapi:"https://comments.vaa.la",fallbackWaline:"/public/",artalkapi:"https://ak-gw.pk.vaa.la:30443/"},sitename:"Vaala 的博客"}},2547:function(){}},function(e){e.O(0,[460,788,141,741,914,886,839,534,397,704,744],function(){return e(e.s=7689)}),_N_E=e.O()}]);