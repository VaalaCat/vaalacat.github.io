<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="stylesheet" href="/_next/static/css/dff3ca822382fad3.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/633a9ad1601bb6ee.css" data-precedence="next"/><link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css"/><title>Mysql的UTF8与UTF8mb4</title><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" noModule=""></script></head><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css"/><body class="antialiased min-h-screen bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-50"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="max-w-2xl mx-auto py-10 px-4"><header><div class="flex items-center justify-between"><button class="border rounded-md w-6 h-6 flex items-center justify-center"><span class="sr-only">Toggle mode</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"></path></svg></button><nav class="ml-auto text-sm font-medium space-x-6"><a class="hover:text-sky-500" href="/">Home</a><a class="hover:text-sky-500" href="/about/">About</a><a class="hover:text-sky-500" href="/link/">Friends</a></nav></div></header><main><article class="py-6 prose dark:prose-invert"><h1 class="mb-2">Mysql的UTF8与UTF8mb4</h1><hr class="my-4"/><time dateTime="2021-04-28T12:44:38.000Z" class="mb-2 block text-xs text-gray-600 dark:text-gray-300">April 28, 2021</time><p>由于某个神秘项目的需要，出现了一个导入上亿条 utf8 数据到 mysql 5.7 中的需求，在实际使用的过程中，我发现 node 在向数据库中写入中文数据时会出现类似下面的报错</p>
<pre><code>failed: Error: Incorrect string value: &#x27;\\xC4\\x83ri&#x27; for column &#x27;name&#x27; at row 1
</code></pre>
<p>于是我猜测是字符编码的问题，于是就将编码全都改成了 utf8，但尝试过后还是存在这个报错，遂上 stackoverflow 学习了以下前人的经验，发现了一篇文章 <a href="https://mathiasbynens.be/notes/mysql-utf8mb4#utf8-to-utf8mb4">How to support full Unicode in MySQL databases · Mathias Bynens</a> 这里详细讲解了 mysql 中 utf8 编码的问题，并且指出 mysql 中推荐一直使用完整的 utf8mb4 编码，这里对文章做了一个翻译</p>
<h2>修改库、表、列</h2>
<ul>
<li>数据库名</li>
</ul>
<pre><code>ALTER DATABASE 库 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
</code></pre>
<ul>
<li>表名</li>
</ul>
<pre><code>ALTER TABLE 表 CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
</code></pre>
<ul>
<li>列名</li>
</ul>
<pre><code>ALTER TABLE 表 CHANGE 列1 列2 VARCHAR(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
</code></pre>
<h2>修改配置文件</h2>
<pre><code>[client]  
default-character-set = utf8mb4  
  
[mysql]  
default-character-set = utf8mb4  
  
[mysqld]  
character-set-server = utf8mb4  
collation-server = utf8mb4_unicode_ci
</code></pre>
<p>然后重启服务</p>
<pre><code>sudo service mysql restart
</code></pre>
<h2>检查更改结果</h2>
<p>最终的修改结果应该如下所示，注意其中只有系统编码还是 utf8</p>
<pre><code>mysql&gt; SHOW VARIABLES WHERE Variable_name LIKE &#x27;character_set_%&#x27; OR Variable_name LIKE &#x27;collation%&#x27;;
+--------------------------+--------------------+
| Variable_name            | Value              |
+--------------------------+--------------------+
| character_set_client     | utf8mb4            |
| character_set_connection | utf8mb4            |
| character_set_database   | utf8mb4            |
| character_set_filesystem | binary             |
| character_set_results    | utf8mb4            |
| character_set_server     | utf8mb4            |
| character_set_system     | utf8               |
| collation_connection     | utf8mb4_unicode_ci |
| collation_database       | utf8mb4_unicode_ci |
| collation_server         | utf8mb4_unicode_ci |
+--------------------------+--------------------+
10 rows in set (0.00 sec)
</code></pre>
<h2>思考</h2>
<p>由于 mysql 并没有对 utf8mb4 编码进行大力推荐使用，导致现在很多的项目还在使用不完整的 utf8 编码，这里我就联想到了 mysql 中 GBK 编码存在的宽字节注入</p>
<blockquote>
<p>宽字节注入：因为字符集不同 躲过 SQL 注入过滤函数 <code>addslashes()</code> 使 <code>addslashes</code> 过滤的<span style="color:red">单引号、双引号、反斜杠、NULL</span>可以利用，从而绕过SQL注入防护达成SQL注入</p>
</blockquote>
<p>也是因为字符集不统一造成的逃逸，这里的 utf8 虽然我还没有看到相关的文章对其进行利用，不过这里显然是存在安全风险的，特别是对于中文站点，自我感觉容易造成二次注入，所以要注意以后使用 mysql 的时候一定要规避 utf8 编码，全部换成 utf8mb4，也不差那一字节的空间。</p>
<h2>参考</h2>
<ul>
<li><a href="https://mathiasbynens.be/notes/mysql-utf8mb4#utf8-to-utf8mb4">How to support full Unicode in MySQL databases · Mathias Bynens</a></li>
<li><a href="https://stackoverflow.com/questions/30951226/mysql-encoding-error">Mysql encoding error</a></li>
<li><a href="https://lalajun.github.io/2018/05/11/mysql-%E5%AD%97%E7%AC%A6%E9%9B%86%E6%BC%8F%E6%B4%9E/#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5">Mysql-字符集漏洞分析</a></li>
<li><a href="https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html">Mysql字符编码利用技巧</a></li>
</ul><div class="text-sm w-full text-center text-slate-500 mt-6 mb-2">- The End -</div><hr/><div></div></article></main><footer><p class="text-sm text-slate-500 dark:text-slate-400 text-center mb-0 sm:mb-10">Copyrights © <!-- -->2024<!-- --> VaalaCat. All Rights Reserved.</p></footer></div><script src="/_next/static/chunks/webpack-a4c0af672d31de67.js" async=""></script><script src="/_next/static/chunks/e5a6a3a4-3bb818ecd9bb262c.js" async=""></script><script src="/_next/static/chunks/313-7e64359f4c0a3e6a.js" async=""></script><script src="/_next/static/chunks/main-app-057d0b1a1c3214a3.js" async=""></script></body></html><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/dff3ca822382fad3.css\",{\"as\":\"style\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/633a9ad1601bb6ee.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"4:I{\"id\":\"9134\",\"chunks\":[\"272:static/chunks/webpack-a4c0af672d31de67.js\",\"115:static/chunks/e5a6a3a4-3bb818ecd9bb262c.js\",\"313:static/chunks/313-7e64359f4c0a3e6a.js\"],\"name\":\"\",\"async\":false}\n6:I{\"id\":\"1181\",\"chunks\":[\"272:static/chunks/webpack-a4c0af672d31de67.js\",\"115:static/chunks/e5a6a3a4-3bb818ecd9bb262c.js\",\"313:static/chunks/313-7e64359f4c0a3e6a.js\"],\"name\":\"\",\"async\":false}\n7:I{\"id\":\"4304\",\"chunks\":[\"16:static/chunks/16-ac25bf4963a321a9.js\",\"700:static/chunks/700-52cc25b5c0cceee9.js\",\"185:static/ch"])</script><script>self.__next_f.push([1,"unks/app/layout-c7cc3f406ea67f8f.js\"],\"name\":\"Providers\",\"async\":false}\n8:I{\"id\":\"7801\",\"chunks\":[\"16:static/chunks/16-ac25bf4963a321a9.js\",\"700:static/chunks/700-52cc25b5c0cceee9.js\",\"185:static/chunks/app/layout-c7cc3f406ea67f8f.js\"],\"name\":\"ModeToggle\",\"async\":false}\n9:I{\"id\":\"1016\",\"chunks\":[\"16:static/chunks/16-ac25bf4963a321a9.js\",\"700:static/chunks/700-52cc25b5c0cceee9.js\",\"185:static/chunks/app/layout-c7cc3f406ea67f8f.js\"],\"name\":\"\",\"async\":false}\na:I{\"id\":\"5284\",\"chunks\":[\"16:static/chunks/16-ac25b"])</script><script>self.__next_f.push([1,"f4963a321a9.js\",\"700:static/chunks/700-52cc25b5c0cceee9.js\",\"185:static/chunks/app/layout-c7cc3f406ea67f8f.js\"],\"name\":\"Analytics\",\"async\":false}\nb:I{\"id\":\"674\",\"chunks\":[\"272:static/chunks/webpack-a4c0af672d31de67.js\",\"115:static/chunks/e5a6a3a4-3bb818ecd9bb262c.js\",\"313:static/chunks/313-7e64359f4c0a3e6a.js\"],\"name\":\"\",\"async\":false}\nc:I{\"id\":\"2236\",\"chunks\":[\"272:static/chunks/webpack-a4c0af672d31de67.js\",\"115:static/chunks/e5a6a3a4-3bb818ecd9bb262c.js\",\"313:static/chunks/313-7e64359f4c0a3e6a.js\"],\"name\""])</script><script>self.__next_f.push([1,":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/dff3ca822382fad3.css\",\"precedence\":\"next\"}]],[\"$\",\"$L4\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/Mysql%E7%9A%84%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%9A%84%E5%A4%A7%E5%9D%91/\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"Mysql%E7%9A%84%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%9A%84%E5%A4%A7%E5%9D%91\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"Mysql的字符编码的大坑\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$L5\",null],\"globalErrorComponent\":\"$6\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css\"}],[\"$\",\"body\",null,{\"className\":\"antialiased min-h-screen bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-50\",\"children\":[\"$\",\"$L7\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto py-10 px-4\",\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[[\"$\",\"$L8\",null,{}],[\"$\",\"nav\",null,{\"className\":\"ml-auto text-sm font-medium space-x-6\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"/\",\"className\":\"hover:text-sky-500\",\"children\":\"Home\"}],[\"$\",\"$L9\",null,{\"href\":\"/about\",\"className\":\"hover:text-sky-500\",\"children\":\"About\"}],[\"$\",\"$L9\",null,{\"href\":\"/link\",\"className\":\"hover:text-sky-500\",\"children\":\"Friends\"}]]}]]}]}],[\"$\",\"main\",null,{\"children\":[\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"p\",null,{\"className\":\"text-sm text-slate-500 dark:text-slate-400 text-center mb-0 sm:mb-10\",\"children\":[\"Copyrights © \",2024,\" VaalaCat. All Rights Reserved.\"]}]}]]}],[\"$\",\"$La\",null,{}]]}]}]]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css\"}],[\"$\",\"body\",null,{\"className\":\"antialiased min-h-screen bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-50\",\"children\":[\"$\",\"$L7\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto py-10 px-4\",\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[[\"$\",\"$L8\",null,{}],[\"$\",\"nav\",null,{\"className\":\"ml-auto text-sm font-medium space-x-6\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"/\",\"className\":\"hover:text-sky-500\",\"children\":\"Home\"}],[\"$\",\"$L9\",null,{\"href\":\"/about\",\"className\":\"hover:text-sky-500\",\"children\":\"About\"}],[\"$\",\"$L9\",null,{\"href\":\"/link\",\"className\":\"hover:text-sky-500\",\"children\":\"Friends\"}]]}]]}]}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"slug\",\"Mysql%E7%9A%84%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%9A%84%E5%A4%A7%E5%9D%91\",\"c\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$Ld\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"Mysql的字符编码的大坑\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/633a9ad1601bb6ee.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"Mysql%E7%9A%84%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%9A%84%E5%A4%A7%E5%9D%91\",\"c\"]},\"styles\":[]}],\"segment\":\"posts\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"p\",null,{\"className\":\"text-sm text-slate-500 dark:text-slate-400 text-center mb-0 sm:mb-10\",\"children\":[\"Copyrights © \",2024,\" VaalaCat. All Rights Reserved.\"]}]}]]}],[\"$\",\"$La\",null,{}]]}]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:I{\"id\":\"4083\",\"chunks\":[\"232:static/chunks/ad809e52-8ff9ed3aaf334a74.js\",\"249:static/chunks/7f34000f-53a298e23e93d2d0.js\",\"206:static/chunks/c6f2715a-9295945954d32d44.js\",\"578:static/chunks/578-5ca193d330e7469e.js\",\"11:static/chunks/11-58372cdb3fd1b1af.js\",\"629:static/chunks/629-cdae87bfb6a1efc0.js\",\"227:static/chunks/app/[year]/[mon]/[date]/[name]/page-aa83ec51055e4ecf.js\"],\"name\":\"PostContent\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"article\",null,{\"className\":\"py-6 prose dark:prose-invert\",\"children\":[\"$\",\"$Le\",null,{\"post\":{\"title\":\"Mysql的UTF8与UTF8mb4\",\"date\":\"2021-04-28T12:44:38.000Z\",\"body\":{\"raw\":\"\",\"code\":\"var Component=(()=\u003e{var h=Object.create;var l=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var _=(t,e)=\u003e()=\u003e(e||t((e={exports:{}}).exports,e),e.exports),E=(t,e)=\u003e{for(var r in e)l(t,r,{get:e[r],enumerable:!0})},s=(t,e,r,i)=\u003e{if(e\u0026\u0026typeof e==\\\"object\\\"||typeof e==\\\"function\\\")for(let c of m(e))!b.call(t,c)\u0026\u0026c!==r\u0026\u0026l(t,c,{get:()=\u003ee[c],enumerable:!(i=u(e,c))||i.enumerable});return t};var p=(t,e,r)=\u003e(r=t!=null?h(f(t)):{},s(e||!t||!t.__esModule?l(r,\\\"default\\\",{value:t,enumerable:!0}):r,t)),y=t=\u003es(l({},\\\"__esModule\\\",{value:!0}),t);var o=_((R,a)=\u003e{a.exports=_jsx_runtime});var T={};E(T,{default:()=\u003eL,frontmatter:()=\u003eA});var n=p(o()),A={title:\\\"Mysql\\\\u7684UTF8\\\\u4E0EUTF8mb4\\\",date:new Date(1619613878e3),tags:[\\\"mysql\\\",\\\"\\\\u7F16\\\\u7801\\\",\\\"utf8\\\"],categories:[[\\\"Technique\\\",\\\"Environment\\\"]]};function d(t){let e=Object.assign({p:\\\"p\\\",pre:\\\"pre\\\",code:\\\"code\\\",a:\\\"a\\\",h2:\\\"h2\\\",ul:\\\"ul\\\",li:\\\"li\\\",blockquote:\\\"blockquote\\\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\\\"\\\\u7531\\\\u4E8E\\\\u67D0\\\\u4E2A\\\\u795E\\\\u79D8\\\\u9879\\\\u76EE\\\\u7684\\\\u9700\\\\u8981\\\\uFF0C\\\\u51FA\\\\u73B0\\\\u4E86\\\\u4E00\\\\u4E2A\\\\u5BFC\\\\u5165\\\\u4E0A\\\\u4EBF\\\\u6761 utf8 \\\\u6570\\\\u636E\\\\u5230 mysql 5.7 \\\\u4E2D\\\\u7684\\\\u9700\\\\u6C42\\\\uFF0C\\\\u5728\\\\u5B9E\\\\u9645\\\\u4F7F\\\\u7528\\\\u7684\\\\u8FC7\\\\u7A0B\\\\u4E2D\\\\uFF0C\\\\u6211\\\\u53D1\\\\u73B0 node \\\\u5728\\\\u5411\\\\u6570\\\\u636E\\\\u5E93\\\\u4E2D\\\\u5199\\\\u5165\\\\u4E2D\\\\u6587\\\\u6570\\\\u636E\\\\u65F6\\\\u4F1A\\\\u51FA\\\\u73B0\\\\u7C7B\\\\u4F3C\\\\u4E0B\\\\u9762\\\\u7684\\\\u62A5\\\\u9519\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`failed: Error: Incorrect string value: '\\\\\\\\\\\\\\\\xC4\\\\\\\\\\\\\\\\x83ri' for column 'name' at row 1\\n`})}),`\\n`,(0,n.jsxs)(e.p,{children:[\\\"\\\\u4E8E\\\\u662F\\\\u6211\\\\u731C\\\\u6D4B\\\\u662F\\\\u5B57\\\\u7B26\\\\u7F16\\\\u7801\\\\u7684\\\\u95EE\\\\u9898\\\\uFF0C\\\\u4E8E\\\\u662F\\\\u5C31\\\\u5C06\\\\u7F16\\\\u7801\\\\u5168\\\\u90FD\\\\u6539\\\\u6210\\\\u4E86 utf8\\\\uFF0C\\\\u4F46\\\\u5C1D\\\\u8BD5\\\\u8FC7\\\\u540E\\\\u8FD8\\\\u662F\\\\u5B58\\\\u5728\\\\u8FD9\\\\u4E2A\\\\u62A5\\\\u9519\\\\uFF0C\\\\u9042\\\\u4E0A stackoverflow \\\\u5B66\\\\u4E60\\\\u4E86\\\\u4EE5\\\\u4E0B\\\\u524D\\\\u4EBA\\\\u7684\\\\u7ECF\\\\u9A8C\\\\uFF0C\\\\u53D1\\\\u73B0\\\\u4E86\\\\u4E00\\\\u7BC7\\\\u6587\\\\u7AE0 \\\",(0,n.jsx)(e.a,{href:\\\"https://mathiasbynens.be/notes/mysql-utf8mb4#utf8-to-utf8mb4\\\",children:\\\"How to support full Unicode in MySQL databases \\\\xB7 Mathias Bynens\\\"}),\\\" \\\\u8FD9\\\\u91CC\\\\u8BE6\\\\u7EC6\\\\u8BB2\\\\u89E3\\\\u4E86 mysql \\\\u4E2D utf8 \\\\u7F16\\\\u7801\\\\u7684\\\\u95EE\\\\u9898\\\\uFF0C\\\\u5E76\\\\u4E14\\\\u6307\\\\u51FA mysql \\\\u4E2D\\\\u63A8\\\\u8350\\\\u4E00\\\\u76F4\\\\u4F7F\\\\u7528\\\\u5B8C\\\\u6574\\\\u7684 utf8mb4 \\\\u7F16\\\\u7801\\\\uFF0C\\\\u8FD9\\\\u91CC\\\\u5BF9\\\\u6587\\\\u7AE0\\\\u505A\\\\u4E86\\\\u4E00\\\\u4E2A\\\\u7FFB\\\\u8BD1\\\"]}),`\\n`,(0,n.jsx)(e.h2,{children:\\\"\\\\u4FEE\\\\u6539\\\\u5E93\\\\u3001\\\\u8868\\\\u3001\\\\u5217\\\"}),`\\n`,(0,n.jsxs)(e.ul,{children:[`\\n`,(0,n.jsx)(e.li,{children:\\\"\\\\u6570\\\\u636E\\\\u5E93\\\\u540D\\\"}),`\\n`]}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`ALTER DATABASE \\\\u5E93 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;\\n`})}),`\\n`,(0,n.jsxs)(e.ul,{children:[`\\n`,(0,n.jsx)(e.li,{children:\\\"\\\\u8868\\\\u540D\\\"}),`\\n`]}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`ALTER TABLE \\\\u8868 CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\\n`})}),`\\n`,(0,n.jsxs)(e.ul,{children:[`\\n`,(0,n.jsx)(e.li,{children:\\\"\\\\u5217\\\\u540D\\\"}),`\\n`]}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`ALTER TABLE \\\\u8868 CHANGE \\\\u52171 \\\\u52172 VARCHAR(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\\n`})}),`\\n`,(0,n.jsx)(e.h2,{children:\\\"\\\\u4FEE\\\\u6539\\\\u914D\\\\u7F6E\\\\u6587\\\\u4EF6\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`[client]  \\ndefault-character-set = utf8mb4  \\n  \\n[mysql]  \\ndefault-character-set = utf8mb4  \\n  \\n[mysqld]  \\ncharacter-set-server = utf8mb4  \\ncollation-server = utf8mb4_unicode_ci\\n`})}),`\\n`,(0,n.jsx)(e.p,{children:\\\"\\\\u7136\\\\u540E\\\\u91CD\\\\u542F\\\\u670D\\\\u52A1\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`sudo service mysql restart\\n`})}),`\\n`,(0,n.jsx)(e.h2,{children:\\\"\\\\u68C0\\\\u67E5\\\\u66F4\\\\u6539\\\\u7ED3\\\\u679C\\\"}),`\\n`,(0,n.jsx)(e.p,{children:\\\"\\\\u6700\\\\u7EC8\\\\u7684\\\\u4FEE\\\\u6539\\\\u7ED3\\\\u679C\\\\u5E94\\\\u8BE5\\\\u5982\\\\u4E0B\\\\u6240\\\\u793A\\\\uFF0C\\\\u6CE8\\\\u610F\\\\u5176\\\\u4E2D\\\\u53EA\\\\u6709\\\\u7CFB\\\\u7EDF\\\\u7F16\\\\u7801\\\\u8FD8\\\\u662F utf8\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`mysql\u003e SHOW VARIABLES WHERE Variable_name LIKE 'character_set_%' OR Variable_name LIKE 'collation%';\\n+--------------------------+--------------------+\\n| Variable_name            | Value              |\\n+--------------------------+--------------------+\\n| character_set_client     | utf8mb4            |\\n| character_set_connection | utf8mb4            |\\n| character_set_database   | utf8mb4            |\\n| character_set_filesystem | binary             |\\n| character_set_results    | utf8mb4            |\\n| character_set_server     | utf8mb4            |\\n| character_set_system     | utf8               |\\n| collation_connection     | utf8mb4_unicode_ci |\\n| collation_database       | utf8mb4_unicode_ci |\\n| collation_server         | utf8mb4_unicode_ci |\\n+--------------------------+--------------------+\\n10 rows in set (0.00 sec)\\n`})}),`\\n`,(0,n.jsx)(e.h2,{children:\\\"\\\\u601D\\\\u8003\\\"}),`\\n`,(0,n.jsx)(e.p,{children:\\\"\\\\u7531\\\\u4E8E mysql \\\\u5E76\\\\u6CA1\\\\u6709\\\\u5BF9 utf8mb4 \\\\u7F16\\\\u7801\\\\u8FDB\\\\u884C\\\\u5927\\\\u529B\\\\u63A8\\\\u8350\\\\u4F7F\\\\u7528\\\\uFF0C\\\\u5BFC\\\\u81F4\\\\u73B0\\\\u5728\\\\u5F88\\\\u591A\\\\u7684\\\\u9879\\\\u76EE\\\\u8FD8\\\\u5728\\\\u4F7F\\\\u7528\\\\u4E0D\\\\u5B8C\\\\u6574\\\\u7684 utf8 \\\\u7F16\\\\u7801\\\\uFF0C\\\\u8FD9\\\\u91CC\\\\u6211\\\\u5C31\\\\u8054\\\\u60F3\\\\u5230\\\\u4E86 mysql \\\\u4E2D GBK \\\\u7F16\\\\u7801\\\\u5B58\\\\u5728\\\\u7684\\\\u5BBD\\\\u5B57\\\\u8282\\\\u6CE8\\\\u5165\\\"}),`\\n`,(0,n.jsxs)(e.blockquote,{children:[`\\n`,(0,n.jsxs)(e.p,{children:[\\\"\\\\u5BBD\\\\u5B57\\\\u8282\\\\u6CE8\\\\u5165\\\\uFF1A\\\\u56E0\\\\u4E3A\\\\u5B57\\\\u7B26\\\\u96C6\\\\u4E0D\\\\u540C \\\\u8EB2\\\\u8FC7 SQL \\\\u6CE8\\\\u5165\\\\u8FC7\\\\u6EE4\\\\u51FD\\\\u6570 \\\",(0,n.jsx)(e.code,{children:\\\"addslashes()\\\"}),\\\" \\\\u4F7F \\\",(0,n.jsx)(e.code,{children:\\\"addslashes\\\"}),\\\" \\\\u8FC7\\\\u6EE4\\\\u7684\\\",(0,n.jsx)(\\\"span\\\",{style:{color:\\\"red\\\"},children:\\\"\\\\u5355\\\\u5F15\\\\u53F7\\\\u3001\\\\u53CC\\\\u5F15\\\\u53F7\\\\u3001\\\\u53CD\\\\u659C\\\\u6760\\\\u3001NULL\\\"}),\\\"\\\\u53EF\\\\u4EE5\\\\u5229\\\\u7528\\\\uFF0C\\\\u4ECE\\\\u800C\\\\u7ED5\\\\u8FC7SQL\\\\u6CE8\\\\u5165\\\\u9632\\\\u62A4\\\\u8FBE\\\\u6210SQL\\\\u6CE8\\\\u5165\\\"]}),`\\n`]}),`\\n`,(0,n.jsx)(e.p,{children:\\\"\\\\u4E5F\\\\u662F\\\\u56E0\\\\u4E3A\\\\u5B57\\\\u7B26\\\\u96C6\\\\u4E0D\\\\u7EDF\\\\u4E00\\\\u9020\\\\u6210\\\\u7684\\\\u9003\\\\u9038\\\\uFF0C\\\\u8FD9\\\\u91CC\\\\u7684 utf8 \\\\u867D\\\\u7136\\\\u6211\\\\u8FD8\\\\u6CA1\\\\u6709\\\\u770B\\\\u5230\\\\u76F8\\\\u5173\\\\u7684\\\\u6587\\\\u7AE0\\\\u5BF9\\\\u5176\\\\u8FDB\\\\u884C\\\\u5229\\\\u7528\\\\uFF0C\\\\u4E0D\\\\u8FC7\\\\u8FD9\\\\u91CC\\\\u663E\\\\u7136\\\\u662F\\\\u5B58\\\\u5728\\\\u5B89\\\\u5168\\\\u98CE\\\\u9669\\\\u7684\\\\uFF0C\\\\u7279\\\\u522B\\\\u662F\\\\u5BF9\\\\u4E8E\\\\u4E2D\\\\u6587\\\\u7AD9\\\\u70B9\\\\uFF0C\\\\u81EA\\\\u6211\\\\u611F\\\\u89C9\\\\u5BB9\\\\u6613\\\\u9020\\\\u6210\\\\u4E8C\\\\u6B21\\\\u6CE8\\\\u5165\\\\uFF0C\\\\u6240\\\\u4EE5\\\\u8981\\\\u6CE8\\\\u610F\\\\u4EE5\\\\u540E\\\\u4F7F\\\\u7528 mysql \\\\u7684\\\\u65F6\\\\u5019\\\\u4E00\\\\u5B9A\\\\u8981\\\\u89C4\\\\u907F utf8 \\\\u7F16\\\\u7801\\\\uFF0C\\\\u5168\\\\u90E8\\\\u6362\\\\u6210 utf8mb4\\\\uFF0C\\\\u4E5F\\\\u4E0D\\\\u5DEE\\\\u90A3\\\\u4E00\\\\u5B57\\\\u8282\\\\u7684\\\\u7A7A\\\\u95F4\\\\u3002\\\"}),`\\n`,(0,n.jsx)(e.h2,{children:\\\"\\\\u53C2\\\\u8003\\\"}),`\\n`,(0,n.jsxs)(e.ul,{children:[`\\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\\\"https://mathiasbynens.be/notes/mysql-utf8mb4#utf8-to-utf8mb4\\\",children:\\\"How to support full Unicode in MySQL databases \\\\xB7 Mathias Bynens\\\"})}),`\\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\\\"https://stackoverflow.com/questions/30951226/mysql-encoding-error\\\",children:\\\"Mysql encoding error\\\"})}),`\\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\\\"https://lalajun.github.io/2018/05/11/mysql-%E5%AD%97%E7%AC%A6%E9%9B%86%E6%BC%8F%E6%B4%9E/#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5\\\",children:\\\"Mysql-\\\\u5B57\\\\u7B26\\\\u96C6\\\\u6F0F\\\\u6D1E\\\\u5206\\\\u6790\\\"})}),`\\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\\\"https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html\\\",children:\\\"Mysql\\\\u5B57\\\\u7B26\\\\u7F16\\\\u7801\\\\u5229\\\\u7528\\\\u6280\\\\u5DE7\\\"})}),`\\n`]})]})}function q(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(d,t)})):d(t)}var L=q;return y(T);})();\\n;return Component;\"},\"_id\":\"posts/Mysql的字符编码的大坑.mdx\",\"_raw\":{\"sourceFilePath\":\"posts/Mysql的字符编码的大坑.mdx\",\"sourceFileName\":\"Mysql的字符编码的大坑.mdx\",\"sourceFileDir\":\"posts\",\"contentType\":\"mdx\",\"flattenedPath\":\"posts/Mysql的字符编码的大坑\"},\"type\":\"Post\",\"slug\":\"/posts/Mysql的字符编码的大坑\",\"slugAsParams\":\"Mysql的字符编码的大坑\"}}]}]\n"])</script><script>self.__next_f.push([1,"5:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],[\"$\",\"title\",null,{\"children\":\"Mysql的UTF8与UTF8mb4\"}],null,null,null,null,null,null,null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]],[],null]]\n"])</script>